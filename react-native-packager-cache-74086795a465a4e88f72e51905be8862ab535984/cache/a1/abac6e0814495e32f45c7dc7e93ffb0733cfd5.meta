["f549148cdef2765656c83c062410c517a28436a6","8924229b526302a8e97035c87d87ef7175b5e0b5",["react-native","react-native/Libraries/Image/AssetRegistry","react-native/Libraries/Image/AssetSourceResolver","react-native/Libraries/Image/resolveAssetSource","./Constants"],[157,204,362,537,700],{"version":3,"sources":["/firstPro/node_modules/expo/src/Asset.js"],"names":["FS","ExponentFileSystem","pickScale","scale","meta","scales","length","get","index","findIndex","s","hash","fileHashes","suffix","name","type","OS","test","httpServerLocation","uri","xde","bundleUrl","match","replace","Asset","width","height","downloading","downloaded","downloadCallbacks","Promise","resolve","reject","push","localUri","cacheDirectory","exists","md5","getInfoAsync","cache","downloadAsync","Error","forEach","moduleId","moduleIds","all","map","fromModule","m","byModule","getAssetByID","asset","setCustomSourceTransformer","resolver","fromSource"],"mappings":"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","sourcesContent":["'use strict';\n\nimport { NativeModules, PixelRatio, Platform } from 'react-native';\n\nimport AssetRegistry from 'react-native/Libraries/Image/AssetRegistry';\nimport AssetSourceResolver from 'react-native/Libraries/Image/AssetSourceResolver';\nimport resolveAssetSource from 'react-native/Libraries/Image/resolveAssetSource';\n\nimport { manifest } from './Constants';\n\nconst FS = NativeModules.ExponentFileSystem;\n\n// Return { uri, hash } for an asset's file, picking the correct scale, based on\n// its React Native metadata. If the asset isn't an image just picks the first\n// file.\nconst pickScale = meta => {\n  // This logic is based on that in AssetSourceResolver.js, we just do it with\n  // our own tweaks for Exponent\n\n  const scale = meta.scales.length > 1\n    ? AssetSourceResolver.pickScale(meta.scales, PixelRatio.get())\n    : 1;\n  const index = meta.scales.findIndex(s => s === scale);\n  const hash = meta.fileHashes[index] || meta.fileHashes[0];\n\n  const suffix =\n    '/' +\n    meta.name +\n    (scale === 1 ? '' : '@' + scale + 'x') +\n    '.' +\n    meta.type +\n    '?platform=' +\n    Platform.OS +\n    '&hash=' +\n    meta.hash;\n\n  if (/^https?:/.test(meta.httpServerLocation)) {\n    // This is a full URL, so we avoid prepending bundle URL/cloudfront\n    // This usually means Asset is on a different server, and the URL is present in the bundle\n    return {\n      uri: meta.httpServerLocation + suffix,\n      hash,\n    };\n  }\n\n  if (manifest.xde) {\n    // Development server URI is pieced together\n    return {\n      uri:\n        manifest.bundleUrl.match(/^https?:\\/\\/.*?\\//)[0] +\n          meta.httpServerLocation.replace(/^\\/?/, '') +\n          suffix,\n      hash,\n    };\n  }\n\n  // CDN URI is based directly on the hash\n  return {\n    uri: 'https://d1wp6m56sqw74a.cloudfront.net/~assets/' + hash,\n    hash,\n  };\n};\n\nexport default class Asset {\n  static byModule = {};\n\n  constructor({ name, type, hash, uri, width, height }) {\n    this.name = name;\n    this.type = type;\n    this.hash = hash;\n    this.uri = uri;\n    if (typeof width === 'number') {\n      this.width = width;\n    }\n    if (typeof height === 'number') {\n      this.height = height;\n    }\n\n    this.downloading = false;\n    this.downloaded = false;\n    this.downloadCallbacks = [];\n  }\n\n  static loadAsync(moduleId) {\n    let moduleIds = typeof moduleId === 'number' ? [moduleId] : moduleId;\n    return Promise.all(moduleIds.map(m => Asset.fromModule(m).downloadAsync()));\n  }\n\n  static fromModule(moduleId) {\n    if (Asset.byModule[moduleId]) {\n      return Asset.byModule[moduleId];\n    }\n\n    // TODO(nikki): Make React Native's AssetRegistry save moduleId so we don't\n    //              have to do this here.\n    const meta = AssetRegistry.getAssetByID(moduleId);\n    meta.moduleId = moduleId;\n    const { uri, hash } = pickScale(meta);\n\n    const asset = new Asset({\n      name: meta.name,\n      type: meta.type,\n      hash,\n      uri,\n      width: meta.width,\n      height: meta.height,\n    });\n    Asset.byModule[moduleId] = asset;\n    return asset;\n  }\n\n  async downloadAsync() {\n    if (this.downloaded) {\n      return;\n    }\n    if (this.downloading) {\n      await new Promise((resolve, reject) =>\n        this.downloadCallbacks.push({ resolve, reject })\n      );\n      return;\n    }\n    this.downloading = true;\n\n    try {\n      const localUri = `${FS.cacheDirectory}ExponentAsset-${this.hash}.${this\n        .type}`;\n      let exists, md5;\n      ({ exists, md5 } = await FS.getInfoAsync(localUri, {\n        cache: true,\n        md5: true,\n      }));\n      if (!exists || md5 !== this.hash) {\n        ({ md5 } = await FS.downloadAsync(this.uri, localUri, {\n          cache: true,\n          md5: true,\n        }));\n        if (md5 !== this.hash) {\n          throw new Error(\n            `Downloaded file for asset '${this.name}.${this.type}' ` +\n              `failed MD5 integrity check`\n          );\n        }\n      }\n      this.localUri = localUri;\n      this.downloaded = true;\n      this.downloadCallbacks.forEach(({ resolve }) => resolve());\n    } catch (e) {\n      this.downloadCallbacks.forEach(({ reject }) => reject(e));\n      throw e;\n    } finally {\n      this.downloading = false;\n      this.downloadCallbacks = [];\n    }\n  }\n}\n\n// Override React Native's asset resolution for `Image` components\nresolveAssetSource.setCustomSourceTransformer(resolver => {\n  if (!resolver.asset.moduleId) {\n    return resolver.fromSource(pickScale(resolver.asset).uri);\n  }\n  const asset = Asset.fromModule(resolver.asset.moduleId);\n  return resolver.fromSource(asset.downloaded ? asset.localUri : asset.uri);\n});\n"]}]